-- Insert Second Letter
	INSERT INTO CELINK.TBLOCCLETGENERATED (LOANNUMBER,LETTERNUMBER)
	SELECT distinct TB.INTSUBSERVICERLOANNUMBER as Loan, 2 as WhichLetter
	FROM CELINK.TBLBORROWER TB, CELINK.TBLTRANSACTIONS TT, CELINK.CHOOSELASTRECORD CC
	WHERE TB.INTSUBSERVICERLOANNUMBER = TT.INTSUBSERVICERLOANNUMBER
		AND TT.INTSUBSERVICERLOANNUMBER = CC.CELINKLOAN
		AND TT.IDSTRANSACTIONCOUNT = CC.MAXCOUNT
		AND TB.BTNOCCUPCERTRECEIVED = 0 
		AND TB.INTOCCUPCERTDATESECONDLETTER = Month(CURRENT DATE) 
		AND TT.IDSSTATUSCODE Not In (11,12,20,50,52,54,55,5501,56,70,71,72,73,74,104,110)
		AND TB.INTSUBSERVICERLOANNUMBER not in -- excluding loans with no living borrowers 
			(SELECT TB1.INTSUBSERVICERLOANNUMBER  
			FROM CELINK.TBLBORROWER TB1 
			LEFT JOIN CELINK.TBLCOBORROWER TC1 
			ON TB1.INTSUBSERVICERLOANNUMBER = TC1.INTSUBSERVICERLOANNUMBER
			WHERE TB1.DTMDEATHDATE Is Not Null --There is a death date for the borrower
			AND TC1.INTSUBSERVICERLOANNUMBER Is Null -- There is no co-borrower
			UNION
			SELECT TB2.INTSUBSERVICERLOANNUMBER
			FROM CELINK.TBLBORROWER TB2 
			LEFT JOIN CELINK.TBLCOBORROWER TC2 
			ON TB2.INTSUBSERVICERLOANNUMBER = TC2.INTSUBSERVICERLOANNUMBER
			WHERE TB2.DTMDEATHDATE Is Not Null --There is a death date for the borrower
			AND TC2.INTSUBSERVICERLOANNUMBER Is Not Null --There is a death date for the co-borrower
			AND TC2.DTMDEATHDATE Is Not Null)
	ORDER BY TB.INTSUBSERVICERLOANNUMBER;
